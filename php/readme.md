# PHP

| **Zone à risque**                                   | **Description détaillée**                                                                                                                                                                                                                                                                                                                                                                                                  | **Exemple de code vulnérable**                                         | **Correctif approprié**                                                                                                     |
|-----------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------|
| **Versions PHP vulnérables**                        | Utilisation de PHP 7.2.x < 7.2.27, 7.3.x < 7.3.14, 7.4.x < 7.4.2. Ces versions comportent des failles connues (CVE-2020-7059, CVE-2020-7060) permettant des attaques par injection ou exécution non autorisée de code.                                                                                                                        | Utilisation de PHP 7.2.26 ou 7.3.13 ou 7.4.1                           | Mettre à jour PHP vers 7.2.27, 7.3.14 ou 7.4.2 ou version supérieure.                                                       |
| **Injection SQL**                                   | L’application construit dynamiquement des requêtes SQL à partir de données utilisateur sans séparation stricte entre le code SQL et les données. Cela permet à un attaquant d’injecter du code SQL malveillant, pouvant lire, modifier ou supprimer des données.                                                                           | `$sql = "SELECT * FROM users WHERE id = $_GET['id']";`                 | Utiliser des requêtes préparées PDO :<br>`$stmt = $pdo->prepare('SELECT * FROM users WHERE id = :id'); $stmt->execute(['id' => $_GET['id']]);` |
| **Exécution de commandes système**                  | Utilisation de fonctions comme `system()`, `exec()`, `shell_exec()` avec des entrées utilisateur non filtrées. Un attaquant peut injecter des commandes arbitraires, compromettant le serveur.                                                                                                                                            | `system($_GET['cmd']);`                                                 | Éviter ces fonctions. Si indispensable, valider et échapper les arguments avec `escapeshellcmd()` ou `escapeshellarg()`.     |
| **Validation et filtrage des entrées utilisateur**  | Absence de validation des paramètres reçus (GET, POST, etc.), ce qui permet d’injecter du code ou des caractères inattendus dans l’application, augmentant le risque d’exploitation.                                                                                                               | `$email = $_POST['email'];`                                             | `$email = filter_var($_POST['email'], FILTER_VALIDATE_EMAIL);`                                                              |
| **Sortie HTML non échappée (XSS)**                  | Affichage direct de données utilisateur dans les pages HTML sans échappement, ce qui permet l’injection de scripts malveillants (XSS) exécutés côté client.                                                                                                                                        | `echo $_POST['username'];`                                              | `echo htmlspecialchars($_POST['username'], ENT_QUOTES, 'UTF-8');`                                                           |
| **Permissions et gestion des fichiers**             | Écriture ou inclusion de fichiers basée sur des entrées utilisateur sans contrôle, pouvant permettre l’injection de code ou l’accès à des fichiers sensibles.                                                                                                                                       | `include($_GET['page']);`                                               | Utiliser une liste blanche de fichiers autorisés : `include($pages_autorisees[$_GET['page']]);`                             |
| **Fonctions dynamiques dangereuses**                | Utilisation de fonctions comme `eval()` avec des données utilisateur, permettant l’exécution de code arbitraire.                                                                                                                                                                                  | `eval($_GET['code']);`                                                  | Ne jamais utiliser `eval()` avec des entrées utilisateur.                                                                   |
| **Absence de mises à jour de sécurité**             | Ne pas appliquer les correctifs de sécurité laisse le serveur vulnérable à des failles connues et exploitables publiquement.                                                                                                                               | Utilisation continue d’une version vulnérable                           | Mettre à jour PHP et toutes les dépendances dès la publication d’un correctif.                                              |
